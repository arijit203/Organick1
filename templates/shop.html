<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shop &mdash; Grocery Website</title>
    <!-- Link Swiper's CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="static/css/styles.css" />
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">   -->
  </head>
  <body style="background-color: var(--color-grey)">
    {% for message in get_flashed_messages() %}
    <div class="alert alert-secondary alert-dismissible fade show" role="alert">
        <strong>{{message}}</strong> 
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
        
    {% endfor %}

    <nav class="nav">
      <div class="container nav_container">
        <div class="logo_box">
          <div class="logo_box"><img src="static/images/icon/Logo.svg" alt="" class="logo"/></div>
        </div>
        <ul class="nav_list">
          <li class="nav_item"><a href="index" class="nav_link">Home</a></li>
          <li class="nav_item"><a href="about" class="nav_link">About</a></li>
          <li class="nav_item"><a href="shop" class="nav_link">Shop</a></li>
          <li class="nav_item"><a href="portfolio" class="nav_link">Projects</a></li>
          <li class="nav_item"><a href="blog" class="nav_link">News</a></li>
          <li class="nav_item"><a href="contact" class="nav_link">Contact</a></li>
        </ul>
        <div class="nav_list1">
          <div class="user_button" id="user-btn">
            <img src="static/images/icon/user.png" alt="User" class="user_icon" />
          </div>
          <div class="user_button" id="cart-btn">
            <img src="static/images/icon/shopping-bag-icon.png" alt="Cart" class="user_icon" />
          </div>
          <div class="user_button fas" id="search-btn" >
            <img src="static/images/icon/search.png" alt="search-option" class="user_icon" />
          </div>
          <form action="" class="search-form">
            <input type="search" placeholder="Search Here..." id="search-box"></input>
            <label for="search-box" class="fas fa-search"></label>
          </form>
        </div>
        <div class="shopping-cart">
          {% if current_user.is_authenticated %}
              {% if cart_items %}
                  {% for cart_item,item,category in cart_items %}
                      <div class="box">
                        <a href="/delete_from_cart/{{ cart_item.item_id }}">
                          <i class="fas fa-times"></i>
                        </a>
                        
                        <img class="imi" src="static/images/items/{{ item.name|replace(' ', '_')|lower }}.png" alt="{{ item.name }}">
                        <div class="content">
                            <h3>{{ item.name }}</h3>
                            <span class="quantity">{{ cart_item.quantity }}</span>
                            <span class="multiply">x</span>
                            <span class="price">${{ item.price }}</span>
                        </div>
                      </div>
                  {% endfor %}
                  <h3 class="total">Total: <span>${{ total_price }}</span></h3>
                  <a href="/cart" class="btn">Checkout Cart</a>
              {% else %}
                  <p>Your cart is empty.</p>
              {% endif %}
          {% else %}
              <p>Please log in to view your cart.</p>
          {% endif %}
      </div>
      
        <form method="POST" action="user_login"  class="login-form">
          {% if current_user.is_authenticated %}
              <h3>Welcome, {{ current_user.username }}!</h3>
              <!-- Display other user information as needed -->
      
              <a href="{{ url_for('user_logout') }}" class="btn">Logout</a>
          {% else %}
              {{ form.csrf_token }}
              <h3>Login Form</h3>
              {{ form.email(class="box", placeholder="Enter email", required=true) }}
              {{ form.password_hash(class="box", placeholder="Enter Password", required=true) }}
      
              <div class="remember">
                  <input type="checkbox" name="" id="remember-me">
                  <label for='remember-me'>Remember me</label>
              </div>
              
              <button type="submit" class="btn">Login Now</button>
              <p>Forget password? <a href="#">Click here</a></p>
              <p>Don't have an account? <a href="user_register">Create one</a></p>
          {% endif %}
      </form>
      
      
      </div>
    </nav>
      

    <!-- 3rd page -->
    <header class="mini_header shop_header">
        <div class="container mini_header_container">
            <div class="mini_header_wrapper">
                <div class="mini_header_title">Shop</div>
            </div>
        </div>
    </header>
   
    
    <section class="product">
      <div class="container">
          <div class="section_header_center">
              <h5 class="header_section_title_2">Categories</h5>
              <h2 class="header_section_title_1">Our Products</h2>
          </div>
          <div class="products">
              {% for category in categories %}
                  <div class="category_row">
                      <h2 class="category_header">{{ category.category_name }}</h2>
                      {% for item in category_items_dict[category.category_id][:7] %}
                          <div class="product_card">
                              <div class="product_body">
                                  <img src="static/images/items/{{ item.name|replace(' ', '_')|lower }}.png" alt="{{ item.name }}" class="product_img" />
                                  <h3 class="product_title">{{ item.name }}</h3>
                                  <div class="product_footer">
                                      <h4 class="product_price">Rs. {{ item.price }} per {{ item.unit[item.unit.find("/")+1:] }}</h4>
                                      <div class="product_rating">
                                          {% for i in range(5) %}
                                              <img src="static/images/icon/star.png" alt="" class="star">
                                          {% endfor %}
                                      </div>
                                      <br>        
                                  </div>
                                  <div class="line">
                                    {% if item.quantity <= 5 %}
                                      <span class="low-stock" style="color: red; font-size: 1.2rem;" >Low Stock</span>
                                    {% endif %}
                                  </div>
                              </div>
                              <form method="post" action="/add_to_cart" class="add-to-cart-form">
                                {{ form.csrf_token }}
                                <input type="hidden" name="item_id" value="{{ item.id }}">
                                <input type="hidden" name="category_id" value="{{ item.category_id }}">
                                <input type="number" name="quantity" class="quantity_box" placeholder="Quantity" min="1" max="{{ item.quantity }}">
                                <input type="hidden" name="cart_id" value="{{ cart_item.cart_id if cart_item else '' }}">
                                <button type="submit" class="add_to_cart_btn">
                                    <img src="static/images/cart.png" alt="Add to Cart" class="cart_symbol">
                                </button>
                              </form>  
                          </div>
                      {% endfor %}
                  </div>
              {% endfor %}
          </div>
      </div>
  </section>
  
  
    <section class="subscribe">
      <div class="container sub_container">
        <h2 class="subscribe_text">Subscribe to <br /> our Newsletter</h2>
        <form action="">
          <input type="text" class="form_input" placeholder="Write your Email">
          <button class="form_btn">Subscribe</button>
        </form>
      </div>
    </section>
      <!-- Swiper JS -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

  <!-- Initialize Swiper -->
  <!-- <script>
    var swiper = new Swiper(".mySwiper", {
      pagination: {
        el: ".swiper-pagination",
      },
    });
  </script> -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script src="static/script.js" lang="javascript"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

  <!-- Initialize Swiper -->
  <script>
    var swiper = new Swiper(".mySwiper", {
      pagination: {
        el: ".swiper-pagination",
      },
    });
    function toggleLoginBox() {
      var loginBox = document.getElementById("loginBox");
      loginBox.style.display = loginBox.style.display === "none" ? "block" : "none";
    }
    $(document).ready(function () {
      function showMessageBox(message) {
        var messageBox = $('<div>', {
            class: 'alert alert-dark',
            role: 'alert',
            text: message,
            css: {
                position: 'fixed',
                top: '10px',
                right: '30px',
                zIndex: '9999',
                backgroundColor: '#45474B',
                color: 'white'

            },
        });

        $('body').append(messageBox);

        // Auto-dismiss after 0.5 seconds
        setTimeout(function () {
            messageBox.remove();
        }, 1000);
      }
    
    })

  </script>
  </body>
</html>
